<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Login - Monitor Criptomonedas</title>
  <!-- Tus estilos CSS (puedes copiarlos o hacerlos más breves) -->
</head>
<body class="dark">
  <div id="loginContainer">
    <h2 id="loginTitle">Iniciar Sesión</h2>
    <label for="username">Usuario</label>
    <input type="text" id="username" placeholder="Ingresa tu usuario" />
    <label for="password">Contraseña</label>
    <input type="password" id="password" placeholder="Ingresa tu contraseña" />
    <label for="email" id="emailLabel" style="display:none;">Email</label>
    <input type="email" id="email" placeholder="Ingresa tu email" style="display:none;" />
    <button id="loginBtn">Ingresar</button>
    <button id="toggleLoginBtn">Crear cuenta</button>
    <button id="forgotPassBtn">Olvidé mi contraseña</button>
    <p id="errorMessage"></p>
  </div>

  <div id="recoverContainer" style="display:none;">
    <h2>Recuperar Contraseña</h2>
    <label for="recoverEmail">Tu Email:</label>
    <input type="email" id="recoverEmail" placeholder="Ingresa tu email"/>
    <button id="recoverBtn">Recuperar</button>
    <p id="recoverError"></p>
  </div>

  <script>
    // Ejemplo de lógica de login/registro
    let isRegisterMode = false;
    
    const loginTitle = document.getElementById('loginTitle');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const emailInput = document.getElementById('email');
    const emailLabel = document.getElementById('emailLabel');
    const loginBtn = document.getElementById('loginBtn');
    const toggleLoginBtn = document.getElementById('toggleLoginBtn');
    const forgotPassBtn = document.getElementById('forgotPassBtn');
    const errorMessage = document.getElementById('errorMessage');
    const recoverContainer = document.getElementById('recoverContainer');
    const recoverEmailInput = document.getElementById('recoverEmail');
    const recoverBtn = document.getElementById('recoverBtn');
    const recoverError = document.getElementById('recoverError');
    const loginContainer = document.getElementById('loginContainer');

    // Si alguien ya estaba logueado (localStorage), lo mando directo a monitor.html
    window.addEventListener('DOMContentLoaded', () => {
      const savedUser = localStorage.getItem('loggedUser');
      if (savedUser) {
        window.location.href = 'monitor.html';
      }
    });

    // Botón principal (Ingresar / Registrar)
    loginBtn.addEventListener('click', () => {
      const user = usernameInput.value.trim();
      const pass = passwordInput.value.trim();
      const mail = emailInput.value.trim();

      if (!user || !pass || (isRegisterMode && !mail)) {
        errorMessage.textContent = "Complete los campos.";
        errorMessage.style.display = "block";
        return;
      }
      errorMessage.style.display = "none";

      const users = JSON.parse(localStorage.getItem('users')) || {};

      if (isRegisterMode) {
        // Registro
        if (users[user]) {
          errorMessage.textContent = "Usuario ya existe.";
          errorMessage.style.display = "block";
        } else {
          users[user] = { password: pass, email: mail };
          localStorage.setItem('users', JSON.stringify(users));
          localStorage.setItem('loggedUser', JSON.stringify({ username: user }));
          window.location.href = 'monitor.html';
        }
      } else {
        // Login
        if (users[user] && users[user].password === pass) {
          localStorage.setItem('loggedUser', JSON.stringify({ username: user }));
          window.location.href = 'monitor.html';
        } else {
          errorMessage.textContent = "Credenciales inválidas.";
          errorMessage.style.display = "block";
        }
      }
    });

    // Botón para alternar entre login y registro
    toggleLoginBtn.addEventListener('click', () => {
      isRegisterMode = !isRegisterMode;
      loginTitle.textContent = isRegisterMode ? "Registrar Cuenta" : "Iniciar Sesión";
      loginBtn.textContent = isRegisterMode ? "Registrar" : "Ingresar";
      toggleLoginBtn.textContent = isRegisterMode ? "Ya tengo cuenta" : "Crear cuenta";
      emailInput.style.display = isRegisterMode ? "block" : "none";
      emailLabel.style.display = isRegisterMode ? "block" : "none";
      errorMessage.style.display = "none";
    });

    // Botón Olvidé mi contraseña
    forgotPassBtn.addEventListener('click', () => {
      loginContainer.style.display = 'none';
      recoverContainer.style.display = 'block';
      recoverError.textContent = "";
      recoverError.style.display = "none";
    });

    // Botón Recuperar contraseña
    recoverBtn.addEventListener('click', () => {
      const mail = recoverEmailInput.value.trim();
      if (!mail) {
        recoverError.textContent = "Ingresa tu email.";
        recoverError.style.display = "block";
        return;
      }
      const users = JSON.parse(localStorage.getItem('users')) || {};
      const foundUser = Object.keys(users).find(u => users[u].email === mail);
      if (!foundUser) {
        recoverError.textContent = "No existe un usuario con ese email.";
        recoverError.style.display = "block";
        return;
      }
      // Generar pass nueva
      const newPass = "1234";
      users[foundUser].password = newPass;
      localStorage.setItem('users', JSON.stringify(users));
      alert("Nueva contraseña: " + newPass);

      recoverContainer.style.display = 'none';
      loginContainer.style.display = 'block';
    });
  </script>
</body>
</html>
